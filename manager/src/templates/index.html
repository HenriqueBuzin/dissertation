{% extends "layout.html" %}

{% block content %}
    <div class="container-fluid">
        <h2 class="mt-4">Gerenciamento de Contêineres por Serviço</h2>

        <!-- Formulário para selecionar e criar múltiplos contêineres -->
        <div class="card my-4">
            <div class="card-header bg-primary text-white">Adicionar Novos Contêineres</div>
            <div class="card-body">
                <form method="POST" action="{{ url_for('index') }}">
                    <div class="row">
                        <div class="col-md-6">
                            <label for="container_name" class="form-label">Selecionar Configuração de Contêiner</label>
                            <select name="container_name" id="container_name" class="form-control" required>
                                {% for item in config.containers %}
                                    <option value="{{ item.name }}">{{ item.name }} ({{ item.image }})</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="quantity" class="form-label">Quantidade</label>
                            <input type="number" name="quantity" id="quantity" class="form-control" min="1" required>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col text-end">
                            <button type="submit" class="btn btn-primary">Criar Contêineres</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>        

        <!-- Exibir tabelas separadas para cada serviço com cabeçalho azul claro -->
        <div id="service-tables">
            {% for service_name, containers in service_containers.items() %}
                
                <h3 class="mt-5">{{ service_name | capitalize }}</h3>
            
                <div class="card mb-5 mt-3 service-table">

                    <div class="card-body p-0">
                        <!-- Tabela de contêineres para o serviço atual -->
                        <table class="table table-striped table-hover mb-0">
                            <thead class="table-primary">
                                <tr>
                                    <th>ID</th>
                                    <th>Nome</th>
                                    <th>Status</th>
                                    <th>Imagem</th>
                                    <th>Ações</th>
                                    <th>Logs</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for container in containers %}
                                <tr id="container-{{ container.short_id }}">
                                    <td>{{ container.short_id }}</td>
                                    <td>{{ container.name }}</td>
                                    <td>{{ container.status }}</td>
                                    <td>{{ container.image.tags[0] if container.image.tags else "N/A" }}</td>
                                    <td>
                                        <form method="POST" action="{{ url_for('start_container', container_id=container.short_id) }}" style="display:inline;">
                                            <button type="submit" class="btn btn-success btn-sm">Iniciar</button>
                                        </form>
                                        <form method="POST" action="{{ url_for('pause_container', container_id=container.short_id) }}" style="display:inline;">
                                            <button type="submit" class="btn btn-warning btn-sm">Pausar</button>
                                        </form>
                                        <form method="POST" action="{{ url_for('stop_container', container_id=container.short_id) }}" style="display:inline;">
                                            <button type="submit" class="btn btn-danger btn-sm">Parar</button>
                                        </form>
                                    </td>
                                    <td>
                                        <button onclick="fetchLogs('{{ container.short_id }}')" class="btn btn-info btn-sm">Ver Logs</button>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            {% endfor %}
        </div>
        
        <script>
            function fetchLogs(containerId) {
                fetch(`/logs/${containerId}`)
                    .then(response => response.json())
                    .then(data => {
                        alert(`Logs do Contêiner ${containerId}:\n\n${data.logs}`);
                    })
                    .catch(error => console.error('Erro ao buscar logs:', error));
            }
        </script>
        
{% endblock %}
